<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta content="manixaist.github.io" property="og:site_name">

  <meta content="Cross Platform Game - 02" property="og:title">


  <meta content="article" property="og:type">


  <meta content="<h1>Developer Journal</h1><h4>Github pages for coding projects:</h4><p/><h4>A collection of my hobbyist projects.</h4><p/><a href='http://xkcd.com/1724/'><img src='http://imgs.xkcd.com/comics/proofs.png'/></a" property="og:description">


  <meta content="http://manixaist.github.io/coding/game/xplat/2016/09/09/xplat-pmc-02.html" property="og:url">


  <meta content="2016-09-09T01:00:56-07:00" property="article:published_time">
  <meta content="http://manixaist.github.io/about/" property="article:author">


  <meta property="og:image" content="">


  
  <meta content="coding" property="article:section">
  


  

  <title>Cross Platform Game - 02</title>
  <meta name="description" content="2D Tiled Map for Pac-Man CloneLast time we finished with a binary printing to the console on both platforms; not very exciting.  Today we’re going to start m...">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="/css/main.css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

  <link href='https://fonts.googleapis.com/css?family=PT+Sans' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Fira+Mono' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Source+Code+Pro:400,200,300,500,600,700,900' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Gentium+Basic:400,700' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Alegreya:400,400italic,700' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Lora:400,400italic,700' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Fira+Sans:400,300,500,700' rel='stylesheet' type='text/css'>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-hQpvDQiCJaD2H465dQfA717v7lu5qHWtDbWNPvaTJ0ID5xnPUlVXnKzq7b8YUkbN" crossorigin="anonymous">
  <link rel="canonical" href="http://manixaist.github.io/coding/game/xplat/2016/09/09/xplat-pmc-02.html">
  <link rel="alternate" type="application/rss+xml" title="manixaist.github.io" href="http://manixaist.github.io/feed.xml">
</head>


  <body>
<section>
<nav class="navbar navbar-default navbar-fixed-top">

  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">manixaist.github.io</a>
    </div>


    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        
        

        
        

        
        

        


      </ul>

    <!--  <ul class="nav navbar-nav navbar-right">
        <li><a href="#">Know More!</a></li>

      </ul>-->
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
</section>

<section>
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <div class="jumbotron">
    <div class="container">
      <h1 class="post-title-main" itemprop="name headline">Cross Platform Game - 02</h1>
      <p class="post-meta"><time datetime="2016-09-09T01:00:56-07:00" itemprop="datePublished">Sep 9, 2016</time> • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">manixaist</span></span></p>
      
    </div>

</div>


  <div class="post-content container" itemprop="articleBody">
    <h1 id="d-tiled-map-for-pac-man-clone">2D Tiled Map for Pac-Man Clone</h1>
<p>Last time we finished with a binary printing to the console on both platforms; not very exciting.  Today we’re going to start making this look more like a game by rendering a 2D tiled map to a window.  This map will be the start of our Pac-Man clone, the game maze.</p>

<p>Behold our end goal for today!</p>

<p><img src="/images/linuxout02.png" alt="Running Linux Application" /></p>

<h3 id="priorities">Priorities</h3>
<p>My main goal is to write code that is readable.  The code is not here to impress anyone with fancy uses of the language or getting umpteen things done in a single statement.  Clarity over cleverness or brevity for the sake of these posts.</p>

<p>Also important is making sure we maintain parity on both platforms.  The last thing we need is to spend dozens or even hundreds of hours solving some problem and writing/debugging tons of code only to have it not even compile (or worse compile fine but behave differently).</p>

<p>In the old DOS days, we could pack tile info into some clever struct of OR’d bits, etc, etc…this is not a good idea when the endianness can change on you.  It’s also not really necessary given we no longer run on quite the same extreme low ends of available memory.</p>

<hr />

<h2 id="goals-for-today">Goals for Today</h2>
<ul>
  <li>Install and setup SDL2-Image libraries</li>
  <li>Create a window (800x600 will do nicely)</li>
  <li>Load a PNG onto a texture</li>
  <li>Divide the texture into tiles</li>
  <li>Render the tiles based on map indicies</li>
  <li>Run inside a simple fixed FPS loop</li>
</ul>

<h3 id="assumptions">Assumptions</h3>
<ul>
  <li>You went through the previous post(s)</li>
</ul>

<h4 id="example-code">Example Code</h4>
<p><a href="https://github.com/manixaist/xplat-pmc-tutorial-02">Github repo</a></p>

<h2 id="setup-windows">Setup: Windows</h2>
<p>To enable PNG support (as well as anything other than BMP) we need the SDL2 Image library.  Installing it will be exactly the same as the SDL2 library.</p>

<ul>
  <li><a href="https://www.libsdl.org/projects/SDL_image/">SDL2-Image</a>: download the development libraries and unzip them just like we did with the SDL2 files.  I placed them at the same root level (e.g. alongside ./SDL202.0.4).</li>
</ul>

<p>You’re going to want to place the development dlls in your system folder so they are accessible again as well.</p>

<h3 id="visual-studio-configuration">Visual Studio Configuration:</h3>
<p>All we need to do is add the new SDL_image libs just like before.</p>

<ul>
  <li>Project-&gt;Properties-&gt;Configuration Properties-&gt;C++&gt;Additional Include Directories</li>
  <li>Add “SDL2_image-2.0.1\Include”</li>
  <li>Click Apply</li>
  <li>Project-&gt;Properties-&gt;Linker-&gt;Input-&gt;Additional Dependencies</li>
  <li>Add “SDL2_image.lib”</li>
  <li>Click Apply</li>
  <li>Project-&gt;Properties-&gt;Linker-&gt;General-&gt;Additional Library Directories</li>
  <li>Add your path to the libs (e.g. “..\SDL2_image-2.0.1\lib\x64)</li>
  <li>Click Ok</li>
</ul>

<h2 id="setup-linux">Setup: Linux</h2>
<p>We need the same libs on linux, installing them is as easy as…</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">sudo apt-get libsdl2-image-2.0-0
sudo apt-get libsdl2-image-dev</code></pre></figure>

<hr />

<h2 id="setup-over-back-to-the-game">Setup over, back to the game…</h2>
<p>Check out <a href="http://hackipedia.org/Games/Arcade/Pac-man/pacman,%20dossier.html#Chapter%203">The Pac-Man Dossier Ch#3</a> for some background on how the map is divided.  I’ll be using the same method.  There are tons of Pac-Man related knowledge to be found here.</p>

<p>The high points are, the grid is 28 cols by 36 rows.  The original game was 8px square per tile.  I’m going to bump that up to 16px, but otherwise the map will stay the same.</p>

<p>I’ve created my own set of tiles using Photoshop (based on the original art of course) and placed them under a folder called “./grfx”.</p>

<h3 id="enable-png-in-code-and-loading-the-texture">Enable PNG in code and loading the texture</h3>
<p>Reminder: There are tons of SDL specific tutorials at <a href="http://lazyfoo.net/tutorials/SDL/">lazyfoo.net</a> and I refer to them frequently.  I will point out specific features as we use them, but not in depth, I assume you can read the code and docs, and the SDL tutorials…</p>

<p>We’ll be using the renderer and acceleration, so we need to start initing SDL subsystems.  All we need for now is VIDEO.</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="k">if</span> <span class="p">(</span><span class="n">SDL_Init</span><span class="p">(</span><span class="n">SDL_INIT_VIDEO</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"SDL_Init() failed, error = %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">SDL_GetError</span><span class="p">());</span>
<span class="p">}</span></code></pre></figure>

<p>Creating a window is the same, we make one 800x600 to hold the map (the map is 448x576 px)</p>

<p>We also need a renderer to make use of textures, creating one is easy</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="n">SDL_CreateRenderer</span><span class="p">(</span><span class="o">*</span><span class="n">ppSDLWindow</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">SDL_RENDERER_ACCELERATED</span><span class="p">);</span></code></pre></figure>

<p>Set the color that will clear the renderer.  I made it grey so the map edges would be visible.</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="n">SDL_SetRenderDrawColor</span><span class="p">(</span><span class="o">*</span><span class="n">ppSDLRenderer</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">);</span></code></pre></figure>

<p>One last bit of code setup.  We need to turn on PNG support.</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="n">IMG_Init</span><span class="p">(</span><span class="n">IMG_INIT_PNG</span><span class="p">);</span></code></pre></figure>

<p>Loading a texture takes 2 steps.  First we load the image to a SDL_Surface, the we create a SDL_Texture from that SDL_Surface for the renderer.</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="n">SDL_Texture</span><span class="o">*</span> <span class="nf">LoadTexture</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">szFileName</span><span class="p">,</span> <span class="n">SDL_Renderer</span> <span class="o">*</span><span class="n">pSDLRenderer</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">SDL_Texture</span><span class="o">*</span> <span class="n">pTextureOut</span> <span class="o">=</span> <span class="nb">nullptr</span><span class="p">;</span>
    <span class="n">SDL_Surface</span><span class="o">*</span> <span class="n">pSDLSurface</span> <span class="o">=</span> <span class="n">IMG_Load</span><span class="p">(</span><span class="n">szFileName</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pSDLSurface</span> <span class="o">==</span> <span class="nb">nullptr</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"IMG_Load() failed, error = %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">IMG_GetError</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">pTextureOut</span> <span class="o">=</span> <span class="n">SDL_CreateTextureFromSurface</span><span class="p">(</span><span class="n">pSDLRenderer</span><span class="p">,</span> <span class="n">pSDLSurface</span><span class="p">);</span>
        <span class="n">SDL_FreeSurface</span><span class="p">(</span><span class="n">pSDLSurface</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">pTextureOut</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<h3 id="creating-the-2d-tilemap">Creating the 2D TileMap</h3>
<p>Great, now we can load a texture.  The next step is dividing up that texture into an ordered list of source rects representing the various tiles available.</p>

<p>For our Pac-Man clone, we’re going to assume the texture holds an evenly divisible number of tiles in each direction.  Each tile will be 16x16 pixels (the original was 8x8) and I am leaving some room for future tiles.  Below is an example of the texture layout.</p>

<p><img src="/images/TileLayout02.png" alt="Tile layout" /></p>

<p>So what would the code look like to do all that fancy dividing?</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="kt">bool</span> <span class="n">TiledMap</span><span class="o">::</span><span class="n">Initialize</span><span class="p">(</span>
    <span class="n">SDL_Rect</span> <span class="n">textureRect</span><span class="p">,</span>           <span class="c1">// Size of the texture
</span>    <span class="n">SDL_Rect</span> <span class="n">tileRect</span><span class="p">,</span>              <span class="c1">// size of the tile
</span>    <span class="n">SDL_Texture</span> <span class="o">*</span><span class="n">pTexture</span><span class="p">,</span>          <span class="c1">// texture holding the tiles
</span>    <span class="n">Uint16</span> <span class="o">*</span><span class="n">pMapIndices</span><span class="p">,</span>            <span class="c1">// array of indicies to the tiles
</span>    <span class="n">Uint16</span> <span class="n">countOfIndicies</span><span class="p">)</span>         <span class="c1">// count of that previous array
</span><span class="p">{</span>
    <span class="c1">// Copy the map indicies data
</span>    <span class="n">_pMapIndicies</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Uint16</span><span class="p">[</span><span class="n">countOfIndicies</span><span class="p">]</span> <span class="p">{</span> <span class="p">};</span>
    <span class="n">SDL_memcpy</span><span class="p">(</span><span class="n">_pMapIndicies</span><span class="p">,</span> <span class="n">pMapIndices</span><span class="p">,</span> <span class="n">countOfIndicies</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">Uint16</span><span class="p">));</span>

    <span class="c1">// Copy the texture data
</span>    <span class="n">_pTileTexture</span> <span class="o">=</span> <span class="n">pTexture</span><span class="p">;</span>
    <span class="n">SDL_memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">_textureRect</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">textureRect</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">SDL_Rect</span><span class="p">));</span>

    <span class="c1">// Calculate the total available tiles on the texture 
</span>    <span class="c1">// and allocate space for the source rects
</span>    <span class="n">_tileSize</span> <span class="o">=</span> <span class="n">tileRect</span><span class="p">.</span><span class="n">w</span><span class="p">;</span>         <span class="c1">//Pick either, we assuming they are the same so far
</span>    <span class="n">Uint16</span> <span class="n">textureTilesPerWidth</span>  <span class="o">=</span> <span class="p">(</span><span class="n">_textureRect</span><span class="p">.</span><span class="n">w</span> <span class="o">/</span> <span class="n">_tileSize</span><span class="p">);</span>
    <span class="n">Uint16</span> <span class="n">textureTilesPerHeight</span> <span class="o">=</span> <span class="p">(</span><span class="n">_textureRect</span><span class="p">.</span><span class="n">h</span> <span class="o">/</span> <span class="n">_tileSize</span><span class="p">);</span>
    <span class="n">_cTilesOnTexture</span> <span class="o">=</span> <span class="p">((</span><span class="n">_textureRect</span><span class="p">.</span><span class="n">w</span> <span class="o">/</span> <span class="n">_tileSize</span><span class="p">)</span> <span class="o">*</span> <span class="n">textureTilesPerHeight</span><span class="p">);</span>
    <span class="n">_pTileRects</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SDL_Rect</span><span class="p">[</span><span class="n">_cTilesOnTexture</span><span class="p">]</span> <span class="p">{};</span>
    
    <span class="c1">// Loop through the tiles and set the source rects
</span>    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="n">textureTilesPerHeight</span><span class="p">;</span> <span class="n">r</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">c</span> <span class="o">&lt;</span> <span class="n">textureTilesPerWidth</span><span class="p">;</span> <span class="n">c</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_pTileRects</span><span class="p">[((</span><span class="n">r</span> <span class="o">*</span> <span class="n">textureTilesPerHeight</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span><span class="p">)].</span><span class="n">h</span> <span class="o">=</span> <span class="n">_tileSize</span><span class="p">;</span>
            <span class="n">_pTileRects</span><span class="p">[((</span><span class="n">r</span> <span class="o">*</span> <span class="n">textureTilesPerHeight</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span><span class="p">)].</span><span class="n">w</span> <span class="o">=</span> <span class="n">_tileSize</span><span class="p">;</span>
            <span class="n">_pTileRects</span><span class="p">[((</span><span class="n">r</span> <span class="o">*</span> <span class="n">textureTilesPerHeight</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span><span class="p">)].</span><span class="n">x</span> <span class="o">=</span> <span class="n">_tileSize</span> <span class="o">*</span> <span class="n">c</span><span class="p">;</span>
            <span class="n">_pTileRects</span><span class="p">[((</span><span class="n">r</span> <span class="o">*</span> <span class="n">textureTilesPerHeight</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span><span class="p">)].</span><span class="n">y</span> <span class="o">=</span> <span class="n">_tileSize</span> <span class="o">*</span> <span class="n">r</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<p>This all assumes we have the texture and indicies data already loaded.  We just saw how to load a texture, we’ll get to the indicies in a moment.</p>

<p>First, how do we render all these rects?</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="c1">// Loop through the map of indicies and render each tile in order.
</span><span class="kt">void</span> <span class="n">TiledMap</span><span class="o">::</span><span class="n">Render</span><span class="p">(</span><span class="n">SDL_Renderer</span> <span class="o">*</span><span class="n">pSDLRenderer</span><span class="p">,</span> <span class="n">Uint16</span> <span class="n">cxScreen</span><span class="p">,</span> <span class="n">Uint16</span> <span class="n">cyScreen</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Center the map, so calculate the offsets
</span>    <span class="n">Uint16</span> <span class="n">cxOffset</span> <span class="o">=</span> <span class="p">(</span><span class="n">cxScreen</span> <span class="o">-</span> <span class="p">(</span><span class="n">_cCols</span> <span class="o">*</span> <span class="n">_tileSize</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">Uint16</span> <span class="n">cyOffset</span> <span class="o">=</span> <span class="p">(</span><span class="n">cyScreen</span> <span class="o">-</span> <span class="p">(</span><span class="n">_cRows</span> <span class="o">*</span> <span class="n">_tileSize</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>

    <span class="n">SDL_Rect</span> <span class="n">targetRect</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">_tileSize</span><span class="p">,</span> <span class="n">_tileSize</span> <span class="p">};</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="n">_cRows</span><span class="p">;</span> <span class="n">r</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">c</span> <span class="o">&lt;</span> <span class="n">_cCols</span><span class="p">;</span> <span class="n">c</span><span class="o">++</span><span class="p">)</span> 
        <span class="p">{</span>
            <span class="n">targetRect</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="n">_tileSize</span><span class="p">)</span> <span class="o">+</span> <span class="n">cxOffset</span><span class="p">;</span>
            <span class="n">targetRect</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span> <span class="o">*</span> <span class="n">_tileSize</span><span class="p">)</span> <span class="o">+</span> <span class="n">cyOffset</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">currentTileIndex</span> <span class="o">=</span> <span class="n">_pMapIndicies</span><span class="p">[</span><span class="n">r</span> <span class="o">*</span> <span class="n">_cCols</span> <span class="o">+</span> <span class="n">c</span><span class="p">];</span>

            <span class="n">SDL_RenderCopy</span><span class="p">(</span><span class="n">pSDLRenderer</span><span class="p">,</span> <span class="n">_pTileTexture</span><span class="p">,</span> 
                <span class="o">&amp;</span><span class="n">_pTileRects</span><span class="p">[</span><span class="n">currentTileIndex</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">targetRect</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<h3 id="game-loop">Game Loop</h3>
<p>There are lots of different game loops out there.  I am going to use an extremely simple one for now, since it’s all we need.  We’ll fix the framerate to 60 FPS.</p>

<p><img src="/images/gameloop02.png" alt="Game loop" /></p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="p">...</span>
<span class="kt">bool</span> <span class="n">fQuit</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
<span class="n">SDL_Event</span> <span class="n">eventSDL</span><span class="p">;</span>

<span class="n">Uint32</span> <span class="n">startTicks</span><span class="p">;</span>
<span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">fQuit</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">startTicks</span> <span class="o">=</span> <span class="n">SDL_GetTicks</span><span class="p">();</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">SDL_PollEvent</span><span class="p">(</span><span class="o">&amp;</span><span class="n">eventSDL</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">eventSDL</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">SDL_QUIT</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">fQuit</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">fQuit</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">SDL_RenderClear</span><span class="p">(</span><span class="n">pSDLRenderer</span><span class="p">);</span>
        <span class="n">tiledMap</span><span class="p">.</span><span class="n">Render</span><span class="p">(</span><span class="n">pSDLRenderer</span><span class="p">,</span> <span class="n">c_cxScreen</span><span class="p">,</span> <span class="n">c_cyScreen</span><span class="p">);</span>
        <span class="n">SDL_RenderPresent</span><span class="p">(</span><span class="n">pSDLRenderer</span><span class="p">);</span>

        <span class="c1">// Fix this at ~c_framesPerSecond
</span>        <span class="n">Uint32</span> <span class="n">endTicks</span> <span class="o">=</span> <span class="n">SDL_GetTicks</span><span class="p">();</span>
        <span class="n">Uint32</span> <span class="n">elapsedTicks</span> <span class="o">=</span> <span class="n">endTicks</span> <span class="o">-</span> <span class="n">startTicks</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">elapsedTicks</span> <span class="o">&lt;</span> <span class="n">c_ticksPerFrame</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">SDL_Delay</span><span class="p">(</span><span class="n">c_ticksPerFrame</span> <span class="o">-</span> <span class="n">elapsedTicks</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Ideally you would never execute that “No” branch as it means you spent more than your alloted time per frame.  This means your framerate is not keeping up.</p>

<h3 id="visual-studio">!@$%#^ Visual Studio!!</h3>
<p>I spent a good of time debugging why my</p>
<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="n">IMG_Load</span><span class="p">(</span><span class="n">szFileName</span><span class="p">);</span></code></pre></figure>
<p>was failing.  I knew VS would copy built files to another directory (e.g. ./Debug/x64/…) so I would need to copy my graphics files over.  However, it was still failing.</p>

<p>Visual studio decided that while the exe would get copied to the $(SolutionDir)/{output} folder the current working directory would get set to $(ProjectDir)/.</p>

<p>Remember to check your cwd in cases like this.  You can solve this with an automated copy as part of your post-build in VS</p>

<p><img src="/images/VSPostBuildEvent02.png" alt="VS Post-Build" /></p>

<h3 id="generating-indicies">Generating indicies</h3>
<p>If you’re making a game, find out what tools you need up front, and see if there are ones available in your price range or if you can make them yourself.  For 2D tiles, there are a few options, but we’re going to reuse the same map for a while, so I have it in a static array we can keep copying.  I needed to work out the per-pixel logic anyway.  (If you look at the tiles, you’ll notice there are “inside” or “reverse” versions of each turn and edge).</p>

<h2 id="output">Output</h2>
<hr />
<p>win32</p>

<p><img src="/images/win32out02.png" alt="Running Win32 Application" /></p>

<p>linux</p>

<p><img src="/images/linuxout02.png" alt="Running Linux Application" /></p>

<hr />

<h3 id="coming-soon">Coming soon</h3>
<p>Next time we’re going to add the player sprite and keyboard input.</p>

  </div>

</article>

</section>
<nav class="navbar navbar-default navbar-fixed-bottom">
  <div class="container footer-content">
    <p>2016-09-09 01:00:56 -0700</p>
  </div>
</nav>


  </body>

</html>
